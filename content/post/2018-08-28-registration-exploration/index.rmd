---
title: "Registration Exporation"
author: "George Self"
date: 2018-08-28T08:00:00-07:00
categories: ["cochise"]
tags: ["courses","registration"]
---

```{r setup, include=FALSE}
# Load some libraries
library(tidyverse)
library(here)
library(plotly)
library(kableExtra)
library(lubridate)
library(treemapify)
library(DT)
library(widgetframe)

# Set the rproj home directory
here::here()
```

```{r getDF, echo=FALSE, message=FALSE, results='asis'}

df <- read_csv("reg.csv")

```

## Fall 2018 Registrations by Division

For Fall 2018, the total number of registrations per division as of August 24, 2018, is listed in the following table.

```{r getDivReg, echo=FALSE, results='asis'}

divReg <- select(df,
    crn = "CRN"
    ,date = "Insert_Date"
    ,div = "Divs_Desc"
    ,enrl = "Sect_Enrl"
  ) %>%
  drop_na(date) %>%   # drop records with null values in the date field
  filter(div %in% c(
    "Business/Technology",
    "Liberal Arts",
    "Math/Sciences",
    "Nursing and Allied Health"
  )) %>% # Keep only the larger divisions
  group_by(crn) %>% # This is used to find the max date for each crn
  filter(date == max(date)) # I only want the last day data were recorded
  # filter(wday(.$date) == 1) # Keep only Monday records

# Calculate the total regs per div on the last day that was recorded
regSum <- divReg %>%
  group_by(div) %>%
  summarize(sum(enrl)) %>% # calculate the sum of regs for each div
  rename(
    Div = "div"
    ,Regs = "sum(enrl)"
  ) %>%
  arrange(desc(Regs), Div)

  
kable(regSum, "html") %>%
  kable_styling(bootstrap_options = "striped"
                ,full_width = F
                ,position = "center"
                ) %>%
  row_spec(0, color = 'orange', background = 'brown')

```

This post uses several different _R_ techniques to explore the registrations for the fall 2018 semester. The data were extracted from the college's Banner system just before the start of the semester and was processed to show registration trends for the three months preceding the start of the semester along with the most popular classes per division.


## Fall 2018 Registration Trends

The following graph shows the number of registrations for Fall 2018 classes by division. To simplify the graph, only the number of registrations as of each Monday in the months leading up to the start of the term is recorded. _Note: this graph is interactive. Hover over a trace to see the data value for that point in time. Double-click a division name in the legend to isolate its trace. Click the “compare number on hover” to see the numbers for all traces while hovering._

```{r chartRegTrend, echo=FALSE, results='asis'}

chartReg <- select(df,
    Date = "Insert_Date"
    ,Div = "Divs_Desc"
    ,Enrl = "Sect_Enrl"
  ) %>%
  drop_na(Date) %>%   # drop records with null values in the date field
  filter(Div %in% c(
    "Business/Technology",
    "Liberal Arts",
    "Math/Sciences",
    "Nursing and Allied Health"
  )) %>% # Keep only the larger divisions
  filter(wday(.$Date) == 1) %>% # Keep only Monday records
  group_by(Div, Date) %>%
  summarize(Total = sum(Enrl))

plot_ly(chartReg, x = ~Date, y = ~Total) %>%
  add_lines(color = ~Div)

```

## Largest Classes

The graph above makes me wonder about the liberal arts division, which almost has more students than the other three divisions combined. I wondered if there one or two courses that are disproportionately large when compared to courses in other divisions. For example, ENG 101 is required for nearly every degree awarded so I would expect a lot of students in that course where the other three divisions do not have a single course that is required for nearly every student. The following mosaic plot shows the top seven courses for each division.

```{r chartLgCrse, echo=FALSE, message=FALSE, results='asis'}

crsReg <- select(df,
    crn = "CRN"
    ,subj = "Subj_Code"
    ,crsnum = "Crse_Numb"
    ,date = "Insert_Date"
    ,div = "Divs_Desc"
    ,enrl = "Sect_Enrl"
  ) %>%
  drop_na(date) %>%   # drop records with null values in the date field
  filter(div %in% c(
    "Business/Technology",
    "Liberal Arts",
    "Math/Sciences",
    "Nursing and Allied Health"
  )) %>% # Keep only the larger divisions
  group_by(crn) %>% # This is used to find the max date for each crn
  filter(date == max(date)) %>% # I only want the last day data were recorded
  unite(crs, subj, crsnum) # make a course name from subj+crsnum, like "ENG_101"
  
# Calculate the total regs per course on the last day that was recorded
regSum <- crsReg %>%
  group_by(div,crs) %>%
  summarize(sum(enrl)) %>% # calculate the sum of regs for each course
  top_n(n = 7) %>% # only the top five obs per group
  rename(
   Course = "crs"
   ,Div = "div"
   ,Regs = "sum(enrl)"
  )

# Note: this is a treemap and plotly does not work with that type of chart
ggplot(regSum, aes(area = Regs, fill = Div, label = Course )) +
  geom_treemap(linetype = "solid", color = "gray40") +
  geom_treemap_text(fontface = "italic", place = "center", grow = TRUE)


```


In case you are wondering about the numbers used to generate the plot above, the following table
  
lists the registrations for the top seven classes by division.

```{r tabLgCrse, echo=FALSE, results='asis'}

regSum <- arrange(regSum, Div, desc(Regs))

f1 <- datatable(regSum, options = list(pageLength = 7))
frameWidget(f1)

```

Five of the top seven liberal arts courses (ENG 101, CPD 150, ENG 102, ENG 096, and RDG 092) form the bulk of the large courses at Cochise College. Mat 081, Mat 142, and MAT 151 form the second tier of large courses and all others can be grouped into the smaller courses. Also of interest is the AAA 001 course in the Liberal Arts division. That course does not show up in the college catalog and may be nothing more than a placeholder used by advisors for some purpose.
